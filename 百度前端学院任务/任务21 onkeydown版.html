<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		<style>
			.tag{
				padding: 10px;
				background-color: #98FB98;
				margin: 10px;
				border-radius: 5px;
			}
			#tag-show{
				padding: 10px;
				margin: 10px;
			}
			#tag-show>span{
				transition: all .5s;
				cursor: pointer;
			}
			#tag-show>span:hover:before{
				content: "删除";
				width: auto;
			}
		</style>
	</head>
	<body>
		<label for="tag">Tag</label><input type="text" name="tag" id="tag" value="" />
		<div id="tag-show"></div>
		<label for="hobby-tag">Tag</label><input type="text" id="hobby-tag"/>
		<div id="hobby-tag-show"></div>
		<script>	
			//构造函数
			function addTag(option) {
				this.tag_text = option.tag_text;//输入框
				this.tag_show = option.tag_show;//tag展示
				this.max_num = option.tag_maxnum - 1;//tag最大数量
				this.textArr = [];
				this.init();
			}
			addTag.prototype.init = function() {//初始化
				this.tag_text.onkeydown = this.keydown.bind(this);
			}
			addTag.prototype.keydown = function(event) {
				if(event.keyCode == 32|| event.keyCode == 188 || event.keyCode == 108 || event.keyCode == 13){
					if(this.tag_text.value.trim() == "") {return};
					this.setArr(this.tag_text.value.trim());
				}
			}
			//设置数组，以便渲染
			addTag.prototype.setArr = function(text) {
				//没到最大限制，文本直接推入数组
				if(this.textArr.length != (this.max_num + 1)) {
					if(this.textArr.indexOf(text) > -1){//检查是否有重复
						this.tag_text.value = "";
						return;
					}
					this.textArr.push(text);
					this.rander();
				}else{//达到最大显示，数组的值逐退1位，覆盖最后一个。新文本插入第一位。
					console.log(this.max_num)
					this.textArr.pop();
					this.textArr.unshift(text);
					this.rander();
				}
			}
			//渲染数组，显示tag
			addTag.prototype.rander = function() {
				console.log(this.textArr)
				var textContent = "";
				this.textArr.forEach(function(text) {
					textContent += "<span class='tag'>"+ text +"</span>";
				})
				this.tag_show.innerHTML = textContent;
				this.tag_text.value = "";
				this.getdeleteText();
			}
			addTag.prototype.getdeleteText = function() {
				var tags = this.tag_show.querySelectorAll("span");
				var that = this;
				for(var i = 0; i < tags.length; i++) {
					tags[i].onclick = function() {
						that.deleteArr(this.innerHTML);
					}
				}
			}
			addTag.prototype.deleteArr = function(text){
				var index = this.textArr.indexOf(text);
				this.textArr.splice(index,1);
				this.rander();
			}
			var option = {};
			option.tag_text = document.querySelector("#tag");
			option.tag_show = document.querySelector("#tag-show");
			option.tag_maxnum = 10;
			var tag = new addTag(option);
		</script>
	</body>
</html>
